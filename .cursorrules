# SG-Imports: AI Instructions & Project Context

You are an expert Senior Full Stack Developer. You strictly follow the project's tech stack: Next.js 16 (App Router), React 19, Hero UI, Drizzle ORM, and Tailwind CSS 4.

## üéØ Project Vision

- **Niche:** Import/Logistics Management System for Brazil.
- **Core Goal:** Automate Siscomex/DUIMP processes, tax calculation (II, IPI, PIS, COFINS), and shipment tracking.
- **Architecture:** Multi-tenant SaaS (Organizations & Memberships).

## üõ† Tech Stack Rules

- **Runtime & Package Manager:** Bun (Always use `bun` commands instead of npm/yarn/pnpm).
- **Next.js 16:** Use Server Components by default. Use 'use client' only for interactivity.
- **Database:** PostgreSQL via Supabase.
- **ORM:** Drizzle ORM.
- **Hero UI:** Use Hero UI (@heroui/react) for all UI components. Avoid raw HTML or other UI libs.
- **Tailwind CSS 4:** Use the new v4 syntax. No need for a separate `tailwind.config.ts` unless specific v4 plugins are used. Use utility classes strictly.
- **Drizzle ORM:** Use `postgres.js` driver. Prefer the `db.query` syntax for readability.
- **React 19:** Use new hooks like `useActionState` and `useFormStatus` for forms.

## Specific Tooling Rules

- **Running Scripts:** Suggest `bun run <script>` for project scripts.
- **Installing Packages:** Use `bun add <package>` or `bun add -d <package>`.
- **Database Migrations:** Use `bunx drizzle-kit` for migration commands.
- **Next.js:** Use `bun --bundle` if applicable, and assume Bun's high-speed execution for environment loading.

## üìù Coding Standards

1. **Naming Convention:**
   - Code/DB: English (mandatory).
   - Tax/Legal Terms: English (but keep the Brazilian acronym as a comment, e.g., importTax // II).
   - Files: kebab-case. Components: PascalCase.
2. **Database:**
   - Tables: snake_case.
   - Schema: Defined in src/db/schema.ts.
   - Use \`jsonb\` for flexible data (e.g., \`simulatedProduct\`).
     **i18n (next-intl):**
   - **DO NOT** hardcode strings in components. Always use \`useTranslations\` or \`getTranslations\`.
   - When generating new components or pages, only provide/update the \`messages/pt.json\` dictionary. Do not generate other languages unless requested.
   - Use structured keys in JSON (e.g., \`"Shipments.List.title"\`).
3. **JSON Data Consistency (CRITICAL):**
   - When using \`jsonb\` columns for adhoc items (Simulations), the structure MUST mirror the \`products\` table entity.
   - Use a \`ProductSnapshot\` type: store resolved values (e.g., \`hsCode: "8504.40"\`) instead of Foreign Keys inside JSONs.
   - Always strictly type Drizzle JSON columns using \`.$type<Interface>()\`.
4. **Form Handling:**
   - Use zod for schema validation.
   - Use Server Actions for all mutations.
5. **Data Fetching:**
   - Fetch data in Server Components where possible.
   - Use Suspense for loading states.

   ## ‚ö° Inngest & Workflow Rules (CRITICAL)

- **Directory Structure:**
  - Functions: \`src/inngest/functions/\*.ts\`
  - Client: \`src/inngest/client.ts\`
  - API Route: \`src/app/api/inngest/route.ts\`
- **Pattern:** Use "Step Functions" (\`step.run\`) for all side effects (DB writes, API calls).
- **Concurrency:** Use \`concurrency\` keys based on \`shipmentId\` to prevent race conditions in the same shipment.
- **Events:** Naming convention: \`app/domain.action\` (e.g., \`shipment/contract.signed\`).
- **Idempotency:** All steps must be idempotent. If a step fails and retries, it should not duplicate data (use \`ON CONFLICT DO NOTHING\` or check existence).

## üí° Performance & AI Efficiency (Cursor Specific)

- **Context Loading:** Always reference @src/db/schema.ts before writing queries.
- **Avoid Hallucinations:** If a Hero UI component property is unknown, ask me to check the documentation or use @Web to verify the beta 6 version.
- **Monetary Values:** Never use float for currency. Always use decimal (from Drizzle) or handle as cents (integers) to avoid rounding errors.

## üáßüá∑ Brazil Import Logic

- Remember the cascade of taxes: Base of II -> IPI -> PIS/COFINS -> ICMS.
- NCM (Nomenclatura Comum do Mercosul) is the primary classification key.
- Always use ISO 8601 for dates, but display in DD/MM/YYYY for the user.
